

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>standard_sequence.classy_sequence &mdash; mmwave-labscript  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            mmwave-labscript
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">mmwave-labscript</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">standard_sequence.classy_sequence</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for standard_sequence.classy_sequence</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Feb 16 11:33:13 2023</span>

<span class="sd">@author: sslab</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span>
<span class="n">root_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;X:\userlib\labscriptlib&quot;</span>

<span class="k">if</span> <span class="n">root_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root_path</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">labscriptlib.shot_globals</span> <span class="kn">import</span> <span class="n">shot_globals</span>
<span class="c1">#from shot_globals import shot_globals</span>
<span class="kn">from</span> <span class="nn">spectrum_manager_fifo</span> <span class="kn">import</span> <span class="n">spectrum_manager_fifo</span>
<span class="kn">from</span> <span class="nn">spectrum_manager</span> <span class="kn">import</span> <span class="n">spectrum_manager</span>
<span class="kn">from</span> <span class="nn">calibration</span> <span class="kn">import</span> <span class="n">ta_freq_calib</span><span class="p">,</span> <span class="n">repump_freq_calib</span><span class="p">,</span> <span class="n">biasx_calib</span><span class="p">,</span> <span class="n">biasy_calib</span><span class="p">,</span> <span class="n">biasz_calib</span>
<span class="kn">from</span> <span class="nn">connection_table</span> <span class="kn">import</span> <span class="n">devices</span>
<span class="kn">import</span> <span class="nn">labscript</span>

<span class="n">spcm_sequence_mode</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_sequence_mode</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">devices</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="c1"># fixed parameters in the script</span>
<span class="n">CONST_COIL_OFF_TIME</span> <span class="o">=</span> <span class="mf">1.4e-3</span>  <span class="c1"># minimum time for the MOT coil to be off</span>
<span class="n">CONST_TA_VCO_RAMP_TIME</span> <span class="o">=</span> <span class="mf">1.2e-4</span>
<span class="n">CONST_MIN_SHUTTER_OFF_TIME</span> <span class="o">=</span> <span class="mf">6.28e-3</span>  <span class="c1"># minimum time for shutter to be off and on again</span>
<span class="n">CONST_MIN_SHUTTER_ON_TIME</span> <span class="o">=</span> <span class="mf">3.6e-3</span>  <span class="c1"># minimum time for shutter to be on</span>
<span class="n">CONST_SHUTTER_TURN_ON_TIME</span>  <span class="o">=</span> <span class="mf">2e-3</span> <span class="c1"># for shutter take from start to close to fully close</span>
<span class="n">CONST_SHUTTER_TURN_OFF_TIME</span> <span class="o">=</span> <span class="mf">2e-3</span> <span class="c1"># for shutter take from start to open to fully open</span>
<span class="n">CONST_TA_PUMPING_DETUNING</span> <span class="o">=</span> <span class="o">-</span><span class="mi">251</span>  <span class="c1"># MHz 4-&gt;4 tansition</span>
<span class="n">CONST_REPUMP_DEPUMPING_DETUNING</span> <span class="o">=</span> <span class="o">-</span><span class="mf">201.24</span>  <span class="c1"># MHz 3-&gt;3 transition</span>
<span class="n">CONST_BIPOLAR_COIL_FLIP_TIME</span> <span class="o">=</span> <span class="mf">10e-3</span> <span class="c1"># the time takes to flip the polarity of the coil</span>
<span class="n">CONST_COIL_FEEDBACK_OFF_TIME</span> <span class="o">=</span> <span class="mf">4.5e-3</span> <span class="c1"># how long to turn off the feedback of circuit when flipping polarity</span>
<span class="n">CONST_COIL_RAMP_TIME</span> <span class="o">=</span> <span class="mf">100e-6</span>

<span class="c1"># lasers_852 =  D2Lasers()</span>
<span class="c1"># lasers_852.pulse_imaging(t=300e-6, duration=100e-6)</span>
<span class="c1"># lasers_852.pulse_ta(t=450e-6, duration=100e-6, hold_shutter_open = True)</span>
<span class="c1"># pulser_ta(t=600e-6, duration=100e-6)</span>


<span class="c1"># MOTconfig = {shutter1: True, shutter2: False, shutter3: True}</span>
<span class="c1"># imagconfig = {shutter1: False, shutter2: True, }</span>

<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">Flag</span><span class="p">,</span> <span class="n">auto</span>


<div class="viewcode-block" id="ShutterConfig">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.ShutterConfig">[docs]</a>
<span class="k">class</span> <span class="nc">ShutterConfig</span><span class="p">(</span><span class="n">Flag</span><span class="p">):</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">TA</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">REPUMP</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">MOT_XY</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">MOT_Z</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">IMG_XY</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">IMG_Z</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">OPTICAL_PUMPING</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>

    <span class="n">UPSTREAM</span> <span class="o">=</span> <span class="n">TA</span> <span class="o">|</span> <span class="n">REPUMP</span>
    <span class="n">MOT_FULL</span> <span class="o">=</span> <span class="n">UPSTREAM</span> <span class="o">|</span> <span class="n">MOT_XY</span> <span class="o">|</span> <span class="n">MOT_Z</span>
    <span class="n">MOT_TA</span> <span class="o">=</span> <span class="n">TA</span> <span class="o">|</span> <span class="n">MOT_XY</span> <span class="o">|</span> <span class="n">MOT_Z</span>
    <span class="n">MOT_REPUMP</span> <span class="o">=</span> <span class="n">REPUMP</span> <span class="o">|</span> <span class="n">MOT_XY</span> <span class="o">|</span> <span class="n">MOT_Z</span>

    <span class="n">IMG_FULL</span> <span class="o">=</span> <span class="n">UPSTREAM</span> <span class="o">|</span> <span class="n">IMG_XY</span> <span class="o">|</span> <span class="n">IMG_Z</span>
    <span class="n">IMG_TA</span> <span class="o">=</span> <span class="n">TA</span> <span class="o">|</span> <span class="n">IMG_XY</span> <span class="o">|</span> <span class="n">IMG_Z</span>
    <span class="n">IMG_REPUMP</span> <span class="o">=</span> <span class="n">REPUMP</span> <span class="o">|</span> <span class="n">IMG_XY</span> <span class="o">|</span> <span class="n">IMG_Z</span>

    <span class="n">OPTICAL_PUMPING_FULL</span> <span class="o">=</span> <span class="n">UPSTREAM</span> <span class="o">|</span> <span class="n">OPTICAL_PUMPING</span>
    <span class="n">OPTICAL_PUMPING_TA</span> <span class="o">=</span> <span class="n">TA</span> <span class="o">|</span> <span class="n">OPTICAL_PUMPING</span>
    <span class="n">OPTICAL_PUMPING_REPUMP</span> <span class="o">=</span> <span class="n">REPUMP</span> <span class="o">|</span> <span class="n">OPTICAL_PUMPING</span>

    <span class="c1"># TODO: replace globals with arguments</span>
<div class="viewcode-block" id="ShutterConfig.select_imgaging_shutters">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.ShutterConfig.select_imgaging_shutters">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">select_imgaging_shutters</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">do_repump</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ShutterConfig</span><span class="p">:</span>
        <span class="n">repump_config</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">REPUMP</span> <span class="k">if</span> <span class="n">do_repump</span> <span class="k">else</span> <span class="bp">cls</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
        <span class="n">label</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">imaging_label</span>

        <span class="c1"># TODO: change handling of labels to make full default and raise error when not one of the options</span>
        <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_mot_beams_during_imaging</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>
                <span class="n">shutter_config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">MOT_Z</span> <span class="o">|</span> <span class="n">repump_config</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;xy&quot;</span><span class="p">:</span>
                <span class="n">shutter_config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">MOT_XY</span> <span class="o">|</span> <span class="n">repump_config</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shutter_config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">MOT_FULL</span> <span class="o">|</span> <span class="n">repump_config</span>

        <span class="c1">#If you&#39;re trying to do in-situ imaging, you want to image faster than switch shutters allows for, so you can&#39;t do imaging beam imaging</span>
        <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_img_beams_during_imaging</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_molasses_in_situ_check</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>
                <span class="n">shutter_config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">IMG_Z</span> <span class="o">|</span> <span class="n">repump_config</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;xy&quot;</span><span class="p">:</span>
                <span class="n">shutter_config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">IMG_XY</span> <span class="o">|</span> <span class="n">repump_config</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shutter_config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">IMG_FULL</span> <span class="o">|</span> <span class="n">repump_config</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutter_config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">NONE</span>

        <span class="k">return</span> <span class="n">shutter_config</span></div>
</div>



<span class="c1"># Hardware control classes</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="D2Lasers">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers">[docs]</a>
<span class="k">class</span> <span class="nc">D2Lasers</span><span class="p">:</span>
    <span class="n">shutter_config</span><span class="p">:</span> <span class="n">ShutterConfig</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="c1"># Tune to MOT frequency, full power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta_freq</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_ta_detuning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repump_freq</span> <span class="o">=</span> <span class="mi">0</span><span class="c1"># shot_globals.mot_repump_detuning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta_power</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_ta_power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repump_power</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_repump_power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutter_config</span> <span class="o">=</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">NONE</span>

        <span class="n">devices</span><span class="o">.</span><span class="n">ta_vco</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ta_freq_calib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ta_freq</span><span class="p">))</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">repump_vco</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">repump_freq_calib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repump_freq</span><span class="p">))</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ta_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ta_power</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">repump_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repump_power</span><span class="p">)</span>

        <span class="c1"># TODO: Initialize shutters??</span>


    <span class="c1">#Move freq_calib to a function within here? Probably not needed.</span>
<div class="viewcode-block" id="D2Lasers.ramp_ta_freq">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.ramp_ta_freq">[docs]</a>
    <span class="k">def</span> <span class="nf">ramp_ta_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">final</span><span class="p">):</span>
        <span class="c1"># TODO: check that duration statement here is valid for optical pumping</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">CONST_TA_VCO_RAMP_TIME</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ta_vco</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="n">ta_freq_calib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ta_freq</span><span class="p">),</span>
            <span class="n">final</span><span class="o">=</span><span class="n">ta_freq_calib</span><span class="p">(</span><span class="n">final</span><span class="p">),</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">4e5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta_freq</span> <span class="o">=</span> <span class="n">final</span></div>


<div class="viewcode-block" id="D2Lasers.ramp_repump_freq">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.ramp_repump_freq">[docs]</a>
    <span class="k">def</span> <span class="nf">ramp_repump_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">final</span><span class="p">):</span>
        <span class="c1"># TODO: check that duration statement here is valid for optical pumping</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">CONST_TA_VCO_RAMP_TIME</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">repump_vco</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="n">repump_freq_calib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repump_freq</span><span class="p">),</span>
            <span class="n">final</span><span class="o">=</span><span class="n">repump_freq_calib</span><span class="p">(</span><span class="n">final</span><span class="p">),</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">4e5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repump_freq</span> <span class="o">=</span> <span class="n">final</span></div>


    <span class="k">def</span> <span class="nf">ta_aom_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Turn off the ta beam using aom &quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ta_aom_digital</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital off</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ta_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># analog off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta_power</span> <span class="o">=</span> <span class="mi">0</span>


<div class="viewcode-block" id="D2Lasers.ta_aom_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.ta_aom_on">[docs]</a>
    <span class="k">def</span> <span class="nf">ta_aom_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Turn on the ta beam using aom &quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ta_aom_digital</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital on</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ta_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span>  <span class="c1"># analog to const</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta_power</span> <span class="o">=</span> <span class="n">const</span></div>


<div class="viewcode-block" id="D2Lasers.ta_aom_off">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.ta_aom_off">[docs]</a>
    <span class="k">def</span> <span class="nf">ta_aom_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Turn off the repump beam using aom &quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ta_aom_digital</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital off</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ta_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># analog off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta_power</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="D2Lasers.repump_aom_off">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.repump_aom_off">[docs]</a>
    <span class="k">def</span> <span class="nf">repump_aom_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Turn off the repump beam using aom &quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">repump_aom_digital</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital off</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">repump_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># analog off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repump_power</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="D2Lasers.repump_aom_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.repump_aom_on">[docs]</a>
    <span class="k">def</span> <span class="nf">repump_aom_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Turn on the repump beam using aom &quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">repump_aom_digital</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital on</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">repump_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span>  <span class="c1"># analog to const</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repump_power</span> <span class="o">=</span> <span class="n">const</span></div>



<div class="viewcode-block" id="D2Lasers.ramp_ta_aom">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.ramp_ta_aom">[docs]</a>
    <span class="k">def</span> <span class="nf">ramp_ta_aom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">final_power</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; ramp ta power from current value to final power &quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ta_aom_analog</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">dur</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ta_power</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">final_power</span><span class="p">,</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="D2Lasers.ramp_repump_aom">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.ramp_repump_aom">[docs]</a>
    <span class="k">def</span> <span class="nf">ramp_repump_aom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">final_power</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; ramp repump power from current value to final power &quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">repump_aom_analog</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">dur</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repump_power</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">final_power</span><span class="p">,</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="D2Lasers.update_shutters">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.update_shutters">[docs]</a>
    <span class="k">def</span> <span class="nf">update_shutters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">new_shutter_config</span><span class="p">:</span> <span class="n">ShutterConfig</span><span class="p">,</span> <span class="n">early_close</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">changed_shutters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutter_config</span> <span class="o">^</span> <span class="n">new_shutter_config</span>

        <span class="n">shutters_to_open</span> <span class="o">=</span> <span class="n">changed_shutters</span> <span class="o">&amp;</span> <span class="n">new_shutter_config</span>
        <span class="n">shutters_to_close</span> <span class="o">=</span> <span class="n">changed_shutters</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutter_config</span>

        <span class="c1"># Can we put tjhis somewhere nicer?</span>
        <span class="n">basic_shutters</span> <span class="o">=</span> <span class="p">[</span><span class="n">ShutterConfig</span><span class="o">.</span><span class="n">TA</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">REPUMP</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_XY</span><span class="p">,</span>
                          <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_Z</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">IMG_XY</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">IMG_Z</span><span class="p">,</span>
                          <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">OPTICAL_PUMPING</span><span class="p">]</span>

        <span class="n">shutter_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">ShutterConfig</span><span class="p">,</span> <span class="n">labscript</span><span class="o">.</span><span class="n">Shutter</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">TA</span><span class="p">:</span> <span class="n">devices</span><span class="o">.</span><span class="n">ta_shutter</span><span class="p">,</span>
            <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">REPUMP</span><span class="p">:</span> <span class="n">devices</span><span class="o">.</span><span class="n">repump_shutter</span><span class="p">,</span>
            <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_XY</span><span class="p">:</span> <span class="n">devices</span><span class="o">.</span><span class="n">mot_xy_shutter</span><span class="p">,</span>
            <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_Z</span><span class="p">:</span> <span class="n">devices</span><span class="o">.</span><span class="n">mot_z_shutter</span><span class="p">,</span>
            <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">IMG_XY</span><span class="p">:</span> <span class="n">devices</span><span class="o">.</span><span class="n">img_xy_shutter</span><span class="p">,</span>
            <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">IMG_Z</span><span class="p">:</span> <span class="n">devices</span><span class="o">.</span><span class="n">img_z_shutter</span><span class="p">,</span>
            <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">OPTICAL_PUMPING</span><span class="p">:</span> <span class="n">devices</span><span class="o">.</span><span class="n">optical_pump_shutter</span><span class="p">,}</span>

        <span class="k">for</span> <span class="n">shutter</span> <span class="ow">in</span> <span class="n">basic_shutters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shutter</span> <span class="ow">in</span> <span class="n">shutters_to_open</span><span class="p">:</span>
                <span class="n">shutter_dict</span><span class="p">[</span><span class="n">shutter</span><span class="p">]</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shutter</span> <span class="ow">in</span> <span class="n">shutters_to_close</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">early_close</span><span class="p">:</span>
                    <span class="n">shutter_dict</span><span class="p">[</span><span class="n">shutter</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shutter_dict</span><span class="p">[</span><span class="n">shutter</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shutter_config</span> <span class="o">=</span> <span class="n">new_shutter_config</span></div>

        <span class="c1">#return t?</span>

<span class="c1"># NOTE: This version makes it so that the previous shutters are fully closed before opening the new shutters</span>
    <span class="c1"># def update_shutters(self, t, new_shutter_config: ShutterConfig):</span>
    <span class="c1">#     changed_shutters = self.shutter_config ^ new_shutter_config</span>

    <span class="c1">#     shutters_to_open = changed_shutters &amp; new_shutter_config</span>
    <span class="c1">#     shutters_to_close = changed_shutters &amp; self.shutter_config</span>

    <span class="c1">#     for shutter in shutters_to_close:</span>
    <span class="c1">#         self.shutter_config.shutter_dict[shutter].close(t)</span>

    <span class="c1">#     t += 2*CONST_SHUTTER_TURN_OFF_TIME</span>
    <span class="c1">#     for shutter in shutters_to_open:</span>
    <span class="c1">#         self.shutter_config.shutter_dict[shutter].open(t)</span>

    <span class="c1">#     self.shutter_config = new_shutter_config</span>
    <span class="c1">#     return t</span>

    <span class="c1"># NOTE: If the shutter configuration is changed from the previous pulse, this will cut the previous pulse short</span>
    <span class="c1"># with the AOM by CONST_SHUTTER_TURN_ON_TIME in order to switch the shutters, and start the next pulse exactly at the t specified.</span>
    <span class="c1"># NOTE: The above note should be taken in context with the one below.</span>
<div class="viewcode-block" id="D2Lasers.do_pulse">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.do_pulse">[docs]</a>
    <span class="k">def</span> <span class="nf">do_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">shutter_config</span><span class="p">,</span> <span class="n">ta_power</span><span class="p">,</span> <span class="n">repump_power</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">change_shutters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutter_config</span> <span class="o">!=</span> <span class="n">shutter_config</span>

        <span class="k">if</span> <span class="n">change_shutters</span><span class="p">:</span>
            <span class="c1"># NOTE:Adding this to t makes it so it doesn&#39;t cut the previous pulse short, but shifts the time of the next.</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shutter config changed, adding time to account for switching&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ta_aom_off</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repump_aom_off</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shutter_config</span><span class="p">,</span> <span class="n">early_close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ta_power</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ta_aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ta_power</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ta_power</span> <span class="o">=</span> <span class="n">ta_power</span>
        <span class="k">if</span> <span class="n">repump_power</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repump_aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">repump_power</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repump_power</span> <span class="o">=</span> <span class="n">repump_power</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">dur</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta_aom_off</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repump_aom_off</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">dur</span> <span class="o">&lt;</span> <span class="n">CONST_MIN_SHUTTER_ON_TIME</span><span class="p">)</span> <span class="ow">and</span> <span class="n">change_shutters</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_MIN_SHUTTER_ON_TIME</span> <span class="o">-</span> <span class="n">dur</span>

        <span class="c1"># If doing close_all_shutters, have to make sure that we aren&#39;t opening any of the ones we just closed in the next pulse.</span>
        <span class="c1"># Otherwise they won&#39;t be able to open in time unless there&#39;s enough delay between pulses.</span>
        <span class="k">if</span> <span class="n">close_all_shutters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_SHUTTER_TURN_OFF_TIME</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ta_aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repump_aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="D2Lasers.reset_to_mot_freq">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.reset_to_mot_freq">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_to_mot_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ramp_repump_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">CONST_TA_VCO_RAMP_TIME</span><span class="p">,</span>
                              <span class="n">final</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ramp_ta_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">CONST_TA_VCO_RAMP_TIME</span><span class="p">,</span>
                          <span class="n">final</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_ta_detuning</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_TA_VCO_RAMP_TIME</span>
        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="D2Lasers.reset_to_mot_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.reset_to_mot_on">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_to_mot_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta_aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_ta_power</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repump_aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_repump_power</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_FULL</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span>

        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="D2Lasers.parity_projection_pulse">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.D2Lasers.parity_projection_pulse">[docs]</a>
    <span class="k">def</span> <span class="nf">parity_projection_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ramp_ta_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_parity_projection_ta_detuning</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_TA_VCO_RAMP_TIME</span>
        <span class="c1"># TODO: is this a TA pulse only? Or is repump also supposed to be on?</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_TA</span><span class="p">,</span>
                      <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_parity_projection_ta_power</span><span class="p">,</span>
                      <span class="mi">0</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span></div>
</div>




<div class="viewcode-block" id="TweezerLaser">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerLaser">[docs]</a>
<span class="k">class</span> <span class="nc">TweezerLaser</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tw_power</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">tw_power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity_servo_keep_on</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_tweezers</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<div class="viewcode-block" id="TweezerLaser.start_tweezers">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerLaser.start_tweezers">[docs]</a>
    <span class="k">def</span> <span class="nf">start_tweezers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">spectrum_manager</span><span class="o">.</span><span class="n">start_card</span><span class="p">()</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">spectrum_manager</span><span class="o">.</span><span class="n">start_tweezers</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tweezer start time:&#39;</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tw_power</span><span class="p">)</span></div>


<div class="viewcode-block" id="TweezerLaser.intensity_servo_keep_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerLaser.intensity_servo_keep_on">[docs]</a>
    <span class="k">def</span> <span class="nf">intensity_servo_keep_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; keep the AOM digital high for intensity servo &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="TweezerLaser.aom_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerLaser.aom_on">[docs]</a>
    <span class="k">def</span> <span class="nf">aom_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Turn on the tweezer beam using aom &quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">tweezer_aom_digital</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital off</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">tweezer_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span>  <span class="c1"># analog off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tw_power</span> <span class="o">=</span> <span class="n">const</span></div>


<div class="viewcode-block" id="TweezerLaser.aom_off">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerLaser.aom_off">[docs]</a>
    <span class="k">def</span> <span class="nf">aom_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Turn off the tweezer beam using aom &quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">tweezer_aom_digital</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital off</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">tweezer_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># analog off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tw_power</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="TweezerLaser.ramp_power">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerLaser.ramp_power">[docs]</a>
    <span class="k">def</span> <span class="nf">ramp_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">final_power</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">tweezer_aom_analog</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">dur</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tw_power</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">final_power</span><span class="p">,</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TweezerLaser.sine_mod_power">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerLaser.sine_mod_power">[docs]</a>
    <span class="k">def</span> <span class="nf">sine_mod_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">tweezer_aom_analog</span><span class="o">.</span><span class="n">sine</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">dur</span><span class="p">,</span>
            <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span>
            <span class="n">angfreq</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">dc_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tw_power</span><span class="p">,</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span>
        <span class="p">)</span></div>
</div>






<div class="viewcode-block" id="Microwave">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.Microwave">[docs]</a>
<span class="k">class</span> <span class="nc">Microwave</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="c1"># Shutoff microwaves?</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">uwave_dds_switch</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">uwave_absorp_switch</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></div>


<div class="viewcode-block" id="RydLasers">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers">[docs]</a>
<span class="k">class</span> <span class="nc">RydLasers</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="c1"># Keep the intensity servo on, regardless of BLACs settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blue_intensity_servo_keep_on</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">red_intensity_servo_keep_on</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<div class="viewcode-block" id="RydLasers.blue_intensity_servo_keep_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.blue_intensity_servo_keep_on">[docs]</a>
    <span class="k">def</span> <span class="nf">blue_intensity_servo_keep_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; keep the AOM digital high for intensity servo &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blue_servo_aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="RydLasers.red_intensity_servo_keep_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.red_intensity_servo_keep_on">[docs]</a>
    <span class="k">def</span> <span class="nf">red_intensity_servo_keep_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; keep the AOM digital high for intensity servo &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">red_servo_aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="RydLasers.blue_servo_aom_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.blue_servo_aom_on">[docs]</a>
    <span class="k">def</span> <span class="nf">blue_servo_aom_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">moglabs_456_aom_digital</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital on</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">moglabs_456_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span>  <span class="c1"># analog to const</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blue_power</span> <span class="o">=</span> <span class="n">const</span></div>


<div class="viewcode-block" id="RydLasers.blue_servo_aom_off">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.blue_servo_aom_off">[docs]</a>
    <span class="k">def</span> <span class="nf">blue_servo_aom_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">moglabs_456_aom_digital</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital off</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">moglabs_456_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># analog off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blue_power</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="RydLasers.blue_pulse_aom_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.blue_pulse_aom_on">[docs]</a>
    <span class="k">def</span> <span class="nf">blue_pulse_aom_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">octagon_456_aom_digital</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital on</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">octagon_456_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span>  <span class="c1"># analog to const</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blue_power</span> <span class="o">=</span> <span class="n">const</span></div>


<div class="viewcode-block" id="RydLasers.blue_pulse_aom_off">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.blue_pulse_aom_off">[docs]</a>
    <span class="k">def</span> <span class="nf">blue_pulse_aom_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">octagon_456_aom_digital</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital off</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">octagon_456_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># analog off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blue_power</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="RydLasers.red_servo_aom_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.red_servo_aom_on">[docs]</a>
    <span class="k">def</span> <span class="nf">red_servo_aom_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ipg_1064_aom_digital</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital on</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ipg_1064_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span>  <span class="c1"># analog to const</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">red_power</span> <span class="o">=</span> <span class="n">const</span></div>


<div class="viewcode-block" id="RydLasers.red_servo_aom_off">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.red_servo_aom_off">[docs]</a>
    <span class="k">def</span> <span class="nf">red_servo_aom_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ipg_1064_aom_digital</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital off</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">ipg_1064_aom_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># analog off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">red_power</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="RydLasers.red_pulse_aom_on">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.red_pulse_aom_on">[docs]</a>
    <span class="k">def</span> <span class="nf">red_pulse_aom_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">pulse_1064_digital</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital on</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">pulse_1064_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span>  <span class="c1"># analog to const</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">red_power</span> <span class="o">=</span> <span class="n">const</span></div>


<div class="viewcode-block" id="RydLasers.red_pulse_aom_off">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.red_pulse_aom_off">[docs]</a>
    <span class="k">def</span> <span class="nf">red_pulse_aom_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">pulse_1064_digital</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># digital off</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">pulse_1064_analog</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># analog off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">red_power</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="RydLasers.blue_mirror_1_position">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.blue_mirror_1_position">[docs]</a>
    <span class="k">def</span> <span class="nf">blue_mirror_1_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">mirror_1_horizontal</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">ryd_456_mirror_1_h_position</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">mirror_1_vertical</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">ryd_456_mirror_1_v_position</span><span class="p">)</span></div>


<div class="viewcode-block" id="RydLasers.blue_mirror_2_position">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.blue_mirror_2_position">[docs]</a>
    <span class="k">def</span> <span class="nf">blue_mirror_2_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">mirror_2_horizontal</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">ryd_456_mirror_2_h_position</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">mirror_2_vertical</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">ryd_456_mirror_2_v_position</span><span class="p">)</span></div>


<div class="viewcode-block" id="RydLasers.red_mirror_1_position">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.red_mirror_1_position">[docs]</a>
    <span class="k">def</span> <span class="nf">red_mirror_1_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">mirror_3_horizontal</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">ryd_1064_mirror_1_h_position</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">mirror_3_vertical</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">ryd_1064_mirror_1_v_position</span><span class="p">)</span></div>


<div class="viewcode-block" id="RydLasers.red_mirror_2_position">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydLasers.red_mirror_2_position">[docs]</a>
    <span class="k">def</span> <span class="nf">red_mirror_2_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">mirror_4_horizontal</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">ryd_1064_mirror_2_h_position</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">mirror_4_vertical</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">ryd_1064_mirror_2_v_position</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="UVLamps">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.UVLamps">[docs]</a>
<span class="k">class</span> <span class="nc">UVLamps</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="c1"># Turn off UV lamps</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">uv_switch</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<div class="viewcode-block" id="UVLamps.uv_pulse">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.UVLamps.uv_pulse">[docs]</a>
    <span class="k">def</span> <span class="nf">uv_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flash the UV LED lamps for dur seconds&quot;&quot;&quot;</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">uv_switch</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">dur</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">uv_switch</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span></div>
</div>



<div class="viewcode-block" id="BField">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.BField">[docs]</a>
<span class="k">class</span> <span class="nc">BField</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_x_coil_voltage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_y_coil_voltage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_z_coil_voltage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mot_coils_on</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_mot_coil</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mot_coils_on_current</span> <span class="o">=</span> <span class="mi">10</span><span class="o">/</span><span class="mi">6</span>

        <span class="c1"># Same question as for Dline_lasers, should we automatically initialize the hardware here or in a separate function we can call?</span>

        <span class="c1"># initialize bias_field variable to None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_field</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">devices</span><span class="o">.</span><span class="n">x_coil_current</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">y_coil_current</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">z_coil_current</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mot_coils_on</span><span class="p">:</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">mot_coil_current_ctrl</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mot_coils_on_current</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">mot_coil_current_ctrl</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_x_coil_flip_polarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">final</span><span class="p">):</span>
        <span class="n">coil_voltage_mid_abs</span> <span class="o">=</span> <span class="mf">0.03</span>
        <span class="n">coil_voltage_mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">biasx_calib</span><span class="p">(</span><span class="n">final</span><span class="p">))</span> <span class="o">*</span> <span class="n">coil_voltage_mid_abs</span>
        <span class="n">total_coil_flip_ramp_time</span> <span class="o">=</span> <span class="n">bipolar_coil_flip_time</span> <span class="o">+</span> <span class="n">coil_ramp_time</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">devices</span><span class="o">.</span><span class="n">x_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">coil_ramp_time</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="n">biasx_calib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span><span class="p">),</span>
            <span class="n">final</span><span class="o">=</span><span class="n">coil_voltage_mid</span><span class="p">,</span>  <span class="c1"># sligtly negative voltage to trigger the polarity change</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">x_coil_feedback_off</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">x_coil_feedback_off</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">coil_feedback_off_time</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">x_coil_current</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">coil_voltage_mid</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">bipolar_coil_flip_time</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">devices</span><span class="o">.</span><span class="n">x_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">coil_ramp_time</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="n">coil_voltage_mid</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">biasx_calib</span><span class="p">(</span><span class="n">final</span><span class="p">),</span>  <span class="c1"># 0 mG</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t</span> <span class="o">-=</span> <span class="n">total_coil_flip_ramp_time</span> <span class="c1"># subtract to the begining tp set other coils</span>

        <span class="c1"># Update internal state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span> <span class="o">=</span> <span class="n">final</span>

        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">_y_coil_flip_polarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">final</span><span class="p">):</span>
        <span class="n">coil_voltage_mid_abs</span> <span class="o">=</span> <span class="mf">0.03</span>
        <span class="n">coil_voltage_mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">biasy_calib</span><span class="p">(</span><span class="n">final</span><span class="p">))</span> <span class="o">*</span> <span class="n">coil_voltage_mid_abs</span>
        <span class="n">total_coil_flip_ramp_time</span> <span class="o">=</span> <span class="n">bipolar_coil_flip_time</span> <span class="o">+</span> <span class="n">coil_ramp_time</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">devices</span><span class="o">.</span><span class="n">y_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">coil_ramp_time</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="n">biasy_calib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span><span class="p">),</span>
            <span class="n">final</span><span class="o">=</span><span class="n">coil_voltage_mid</span><span class="p">,</span>  <span class="c1"># sligtly negative voltage to trigger the polarity change</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">y_coil_feedback_off</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;turn feedback off at time t = &#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">y_coil_feedback_off</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">coil_feedback_off_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;turn feedback back on at time t = &#39;</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="n">coil_feedback_off_time</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">y_coil_current</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">coil_voltage_mid</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">bipolar_coil_flip_time</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">devices</span><span class="o">.</span><span class="n">y_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">coil_ramp_time</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="n">coil_voltage_mid</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">biasy_calib</span><span class="p">(</span><span class="n">final</span><span class="p">),</span>  <span class="c1"># 0 mG</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t</span> <span class="o">-=</span> <span class="n">total_coil_flip_ramp_time</span> <span class="c1"># subtract to the begining tp set other coils</span>

        <span class="c1"># Update internal state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span> <span class="o">=</span> <span class="n">final</span>

        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">_z_coil_flip_polarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">final</span><span class="p">):</span>
        <span class="n">coil_voltage_mid_abs</span> <span class="o">=</span> <span class="mf">0.03</span>
        <span class="n">coil_voltage_mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">biasz_calib</span><span class="p">(</span><span class="n">final</span><span class="p">))</span> <span class="o">*</span> <span class="n">coil_voltage_mid_abs</span>
        <span class="n">total_coil_flip_ramp_time</span> <span class="o">=</span> <span class="n">bipolar_coil_flip_time</span> <span class="o">+</span> <span class="n">coil_ramp_time</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">devices</span><span class="o">.</span><span class="n">z_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">coil_ramp_time</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="n">biasz_calib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span><span class="p">),</span>
            <span class="n">final</span><span class="o">=</span><span class="n">coil_voltage_mid</span><span class="p">,</span>  <span class="c1"># sligtly negative voltage to trigger the polarity change</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">z_coil_feedback_off</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">z_coil_feedback_off</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">coil_feedback_off_time</span><span class="p">)</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">z_coil_current</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">coil_voltage_mid</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">bipolar_coil_flip_time</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">devices</span><span class="o">.</span><span class="n">z_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">coil_ramp_time</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="n">coil_voltage_mid</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">biasz_calib</span><span class="p">(</span><span class="n">final</span><span class="p">),</span>  <span class="c1"># 0 mG</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t</span> <span class="o">-=</span> <span class="n">total_coil_flip_ramp_time</span> <span class="c1"># subtract to the begining tp set other coils</span>

        <span class="c1"># Update internal state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span> <span class="o">=</span> <span class="n">final</span>

        <span class="k">return</span> <span class="n">t</span>

<div class="viewcode-block" id="BField.ramp_bias_field">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.BField.ramp_bias_field">[docs]</a>
    <span class="k">def</span> <span class="nf">ramp_bias_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">bias_field_vector</span><span class="p">):</span>
        <span class="c1"># bias_field_vector should be a tuple of the form (x,y,z)</span>
        <span class="c1"># Need to start the ramp earlier if the voltage changes sign</span>
        <span class="n">t_x_coil</span><span class="p">,</span> <span class="n">t_y_coil</span><span class="p">,</span> <span class="n">t_z_coil</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mf">4e-3</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span> <span class="o">*</span> <span class="n">biasx_calib</span><span class="p">(</span><span class="n">bias_field_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span>
                                        <span class="n">t</span> <span class="o">-</span> <span class="mf">4e-3</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span> <span class="o">*</span> <span class="n">biasy_calib</span><span class="p">(</span><span class="n">bias_field_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span>
                                        <span class="n">t</span> <span class="o">-</span> <span class="mf">4e-3</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span> <span class="o">*</span> <span class="n">biasz_calib</span><span class="p">(</span><span class="n">bias_field_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">devices</span><span class="o">.</span><span class="n">x_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t_x_coil</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">CONST_COIL_RAMP_TIME</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">biasx_calib</span><span class="p">(</span><span class="n">bias_field_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">devices</span><span class="o">.</span><span class="n">y_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t_y_coil</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">CONST_COIL_RAMP_TIME</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">biasy_calib</span><span class="p">(</span><span class="n">bias_field_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># 0 mG</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">devices</span><span class="o">.</span><span class="n">z_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t_z_coil</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">CONST_COIL_RAMP_TIME</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">biasz_calib</span><span class="p">(</span><span class="n">bias_field_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>  <span class="c1"># 0 mG</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bias_field</span> <span class="o">=</span> <span class="n">bias_field_vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span> <span class="o">=</span> <span class="n">biasx_calib</span><span class="p">(</span><span class="n">bias_field_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span> <span class="o">=</span> <span class="n">biasy_calib</span><span class="p">(</span><span class="n">bias_field_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span> <span class="o">=</span> <span class="n">biasz_calib</span><span class="p">(</span><span class="n">bias_field_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_COIL_RAMP_TIME</span>
        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="BField.ramp_bias_field_voltage">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.BField.ramp_bias_field_voltage">[docs]</a>
    <span class="k">def</span> <span class="nf">ramp_bias_field_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">voltage_vector</span><span class="p">):</span>
        <span class="c1">#B_field_vector should be a tuple of the form (x,y,z)</span>
        <span class="c1"># Need to start the ramp earlier if the voltage changes sign</span>
        <span class="n">t_x_coil</span><span class="p">,</span> <span class="n">t_y_coil</span><span class="p">,</span> <span class="n">t_z_coil</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mf">4e-3</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span> <span class="o">*</span> <span class="n">voltage_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span>
                                        <span class="n">t</span> <span class="o">-</span> <span class="mf">4e-3</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span> <span class="o">*</span> <span class="n">voltage_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span>
                                        <span class="n">t</span> <span class="o">-</span> <span class="mf">4e-3</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span> <span class="o">*</span> <span class="n">voltage_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">devices</span><span class="o">.</span><span class="n">x_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t_x_coil</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">CONST_COIL_RAMP_TIME</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">voltage_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">devices</span><span class="o">.</span><span class="n">y_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t_y_coil</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">CONST_COIL_RAMP_TIME</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">voltage_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">devices</span><span class="o">.</span><span class="n">z_coil_current</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
            <span class="n">t_z_coil</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">CONST_COIL_RAMP_TIME</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span><span class="p">,</span>
            <span class="n">final</span><span class="o">=</span><span class="n">voltage_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># TODO: add the inverse function of bias_i_calib</span>
        <span class="c1"># self.B_field = B_field_vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_x_voltage</span> <span class="o">=</span> <span class="n">voltage_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_y_voltage</span> <span class="o">=</span> <span class="n">voltage_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_z_voltage</span> <span class="o">=</span> <span class="n">voltage_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_COIL_RAMP_TIME</span>
        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="BField.switch_mot_coils">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.BField.switch_mot_coils">[docs]</a>
    <span class="k">def</span> <span class="nf">switch_mot_coils</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mot_coils_on</span><span class="p">:</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">mot_coil_current_ctrl</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
                <span class="n">t</span><span class="p">,</span>
                <span class="n">duration</span><span class="o">=</span><span class="n">CONST_COIL_RAMP_TIME</span><span class="p">,</span>
                <span class="n">initial</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mot_coils_on_current</span><span class="p">,</span>
                <span class="n">final</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mot_coils_on</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">mot_coil_current_ctrl</span><span class="o">.</span><span class="n">ramp</span><span class="p">(</span>
                <span class="n">t</span><span class="p">,</span>
                <span class="n">duration</span><span class="o">=</span><span class="n">CONST_COIL_RAMP_TIME</span><span class="p">,</span>
                <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">final</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mot_coils_on_current</span><span class="p">,</span>
                <span class="n">samplerate</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mot_coils_on</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_COIL_RAMP_TIME</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_COIL_OFF_TIME</span>
        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="BField.get_op_bias_fields">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.BField.get_op_bias_fields">[docs]</a>
    <span class="k">def</span> <span class="nf">get_op_bias_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the proper bias fields for a given quantization angle from shot globals &quot;&quot;&quot;</span>
        <span class="n">op_biasx_field</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_bias_amp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">op_bias_phi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">op_bias_theta</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">op_biasy_field</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_bias_amp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">op_bias_phi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">op_bias_theta</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">op_biasz_field</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_bias_amp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">op_bias_theta</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">op_biasx_field</span><span class="p">,</span> <span class="n">op_biasy_field</span><span class="p">,</span> <span class="n">op_biasz_field</span></div>
</div>


<div class="viewcode-block" id="Camera">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.Camera">[docs]</a>
<span class="k">class</span> <span class="nc">Camera</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Camera.set_type">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.Camera.set_type">[docs]</a>
    <span class="k">def</span> <span class="nf">set_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="c1"># type = &quot;MOT_manta&quot; or &quot;tweezer_manta&quot; or &quot;kinetix&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span></div>


<div class="viewcode-block" id="Camera.expose">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.Camera.expose">[docs]</a>
    <span class="k">def</span> <span class="nf">expose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">exposure_time</span><span class="p">,</span> <span class="n">trigger_local_manta</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">trigger_local_manta</span><span class="p">:</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">mot_camera_trigger</span><span class="o">.</span><span class="n">go_high</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">mot_camera_trigger</span><span class="o">.</span><span class="n">go_low</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">exposure_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;MOT_manta&quot;</span><span class="p">:</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">manta419b_mot</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span>
                <span class="s1">&#39;manta419b&#39;</span><span class="p">,</span>
                <span class="n">t</span><span class="p">,</span>
                <span class="s1">&#39;atoms&#39;</span><span class="p">,</span>
                <span class="n">exposure_time</span> <span class="o">=</span> <span class="n">exposure_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;tweezer_manta&quot;</span><span class="p">:</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">manta419b_tweezer</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span>
                <span class="s1">&#39;manta419b&#39;</span><span class="p">,</span>
                <span class="n">t</span><span class="p">,</span>
                <span class="s1">&#39;atoms&#39;</span><span class="p">,</span>
                <span class="n">exposure_time</span><span class="o">=</span><span class="n">exposure_time</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;kinetix&quot;</span><span class="p">:</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">kinetix</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span>
                <span class="s1">&#39;Kinetix&#39;</span><span class="p">,</span>
                <span class="n">t</span><span class="p">,</span>
                <span class="s1">&#39;atoms&#39;</span><span class="p">,</span>
                <span class="n">exposure_time</span><span class="o">=</span><span class="n">exposure_time</span><span class="p">,</span>
            <span class="p">)</span></div>
</div>


<div class="viewcode-block" id="EField">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.EField">[docs]</a>
<span class="k">class</span> <span class="nc">EField</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">pass</span></div>


<span class="c1">#Sequence Classes</span>
<span class="c1">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MOTSequence">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.MOTSequence">[docs]</a>
<span class="k">class</span> <span class="nc">MOTSequence</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="c1"># Standard initialization for hardware objects puts everything in</span>
        <span class="c1"># correct state/tuning to start loading the MOT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span> <span class="o">=</span> <span class="n">D2Lasers</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span> <span class="o">=</span> <span class="n">BField</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Microwave_obj</span> <span class="o">=</span> <span class="n">Microwave</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UVLamps_obj</span> <span class="o">=</span> <span class="n">UVLamps</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Camera_obj</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<div class="viewcode-block" id="MOTSequence.do_mot">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.MOTSequence.do_mot">[docs]</a>
    <span class="k">def</span> <span class="nf">do_mot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_uv</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UVLamps_obj</span><span class="o">.</span><span class="n">uv_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">uv_duration</span><span class="p">)</span>
            <span class="c1"># the uv duration should be determined for each dispenser current</span>
            <span class="c1"># generally, get superior loading in the 10s of milliseconds</span>

        <span class="c1"># if using a long UV duration, want to make sure that the MOT doesn&#39;t finish</span>
        <span class="c1"># loading leaving the UV is still on for imaging.</span>
        <span class="n">dur</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dur</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">uv_duration</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_FULL</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_ta_power</span><span class="p">,</span>
                                        <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_repump_power</span><span class="p">,</span> <span class="n">close_all_shutters</span> <span class="o">=</span> <span class="n">close_all_shutters</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="MOTSequence.reset_mot">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.MOTSequence.reset_mot">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_mot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="c1">#B fields</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">mot_coils_on</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">switch_mot_coils</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="n">mot_bias_voltages</span> <span class="o">=</span> <span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_x_coil_voltage</span><span class="p">,</span>
                             <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_y_coil_voltage</span><span class="p">,</span>
                             <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_z_coil_voltage</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">ramp_bias_field_voltage</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mot_bias_voltages</span><span class="p">)</span>

        <span class="c1"># Reset laser frequency and configuration</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">reset_to_mot_freq</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">reset_to_mot_on</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="mf">1e-2</span>

        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="MOTSequence.image_mot">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.MOTSequence.image_mot">[docs]</a>
    <span class="k">def</span> <span class="nf">image_mot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Move to on resonance, make sure AOM is off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_ta_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CONST_TA_VCO_RAMP_TIME</span><span class="p">,</span> <span class="n">ta_freq_calib</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_TA_VCO_RAMP_TIME</span>

        <span class="c1"># Make sure coils are off</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">mot_coils_on</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">switch_mot_coils</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Camera_obj</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="s2">&quot;MOT_manta&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Camera_obj</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_exposure_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;before doing a MOT pulse for image t = &quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_exposure_time</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_FULL</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_ta_power</span><span class="p">,</span>
                                        <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_repump_power</span><span class="p">,</span> <span class="n">close_all_shutters</span> <span class="o">=</span> <span class="n">close_all_shutters</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span></div>


    <span class="k">def</span> <span class="nf">_do_mot_in_situ_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">reset_mot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running do_mot_in_situ_check&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MOT coils = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">mot_coils_on</span><span class="p">)</span>
        <span class="c1"># MOT loading time 500 ms</span>
        <span class="n">mot_load_dur</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_mot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mot_load_dur</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_mot</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># Shutter does not need to be held open</span>

        <span class="c1"># Wait until the MOT disappear for background image</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mf">0.1</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_mot</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># Reset laser frequency so lasers do not jump frequency and come unlocked</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">reset_to_mot_freq</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reset_mot</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset_mot</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span>

    <span class="c1"># TODO: Needs more experimental debugging. When should the shutter close? What timescales should we expect the MOT to disperse in?</span>
    <span class="k">def</span> <span class="nf">_do_mot_tof_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">reset_mot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running do_mot_in_situ_check&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MOT coils = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">mot_coils_on</span><span class="p">)</span>
        <span class="c1"># MOT loading time 500 ms</span>
        <span class="n">mot_load_dur</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_mot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mot_load_dur</span><span class="p">)</span>

        <span class="c1"># assert shot_globals.mot_tof_imaging_delay &gt; CONST_MIN_SHUTTER_OFF_TIME, &quot;time of flight too short for shutter&quot;</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_tof_imaging_delay</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_mot</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># Shutter does not need to be held open</span>

        <span class="c1"># Wait until the MOT disappear for background image</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mf">0.1</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_mot</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># Reset laser frequency so lasers do not jump frequency and come unlocked</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">reset_to_mot_freq</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reset_mot</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset_mot</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span>

    <span class="c1"># Molasses sequences</span>
<div class="viewcode-block" id="MOTSequence.ramp_to_molasses">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.MOTSequence.ramp_to_molasses">[docs]</a>
    <span class="k">def</span> <span class="nf">ramp_to_molasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="c1"># detuning is ramped slowly here (duration = 1e-3) because atoms</span>
        <span class="c1"># see the light during the frequency ramp.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_ta_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_ta_detuning</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_repump_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_repump_detuning</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">switch_mot_coils</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">ramp_bias_field</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Molasses stage&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ta_last_detuning = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ta_freq</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;repump_last_detuning = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ta_freq</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="MOTSequence.do_molasses">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.MOTSequence.do_molasses">[docs]</a>
    <span class="k">def</span> <span class="nf">do_molasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">do_molasses_img_beam</span> <span class="ow">or</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_molasses_mot_beam</span><span class="p">),</span> <span class="s2">&quot;either do_molasses_img_beam or do_molasses_mot_beam has to be on&quot;</span>
        <span class="k">assert</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_ta_detuning</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;bright molasses detuning = 0. TA detuning should be none zero for bright molasses.&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;molasses detuning is </span><span class="si">{</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_ta_detuning</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ramp_to_molasses</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_molasses_mot_beam</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_FULL</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_ta_power</span><span class="p">,</span>
                                <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_repump_power</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="n">close_all_shutters</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_molasses_img_beam</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">IMG_FULL</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_ta_power</span><span class="p">,</span>
                                <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_repump_power</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="n">close_all_shutters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span></div>


    <span class="c1">#Which arguments are actually necessary to pass or even set as a defualt?</span>
    <span class="c1">#How many of them can just be set to globals?</span>
    <span class="c1"># TODO: Maybe pass the shutter config into here? This would get rid of all the if statements?</span>
<div class="viewcode-block" id="MOTSequence.do_molasses_dipole_trap_imaging">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.MOTSequence.do_molasses_dipole_trap_imaging">[docs]</a>
    <span class="k">def</span> <span class="nf">do_molasses_dipole_trap_imaging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">do_repump</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># zero the field</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">ramp_bias_field</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># Ramp to imaging frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_ta_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CONST_TA_VCO_RAMP_TIME</span><span class="p">,</span> <span class="n">ta_freq_calib</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_repump_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CONST_TA_VCO_RAMP_TIME</span><span class="p">,</span> <span class="n">repump_freq_calib</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">t</span><span class="o">+=</span><span class="n">CONST_TA_VCO_RAMP_TIME</span>

        <span class="n">shutter_config</span> <span class="o">=</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">select_imgaging_shutters</span><span class="p">(</span><span class="n">do_repump</span> <span class="o">=</span> <span class="n">do_repump</span><span class="p">)</span>

        <span class="c1"># full power ta and repump pulse</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_exposure_time</span><span class="p">,</span> <span class="n">shutter_config</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">close_all_shutters</span> <span class="o">=</span> <span class="n">close_all_shutters</span><span class="p">)</span>

        <span class="c1"># TODO: ask Lin and Michelle and max() logic and if we always want it there</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Camera_obj</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">camera_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Camera_obj</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span><span class="s2">&quot;MOT_manta&quot;</span> <span class="ow">or</span> <span class="s2">&quot;tweezer_manta&quot;</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_exposure_time</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Camera_obj</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;kinetix&quot;</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_exposure_time</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Camera_obj</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">exposure</span><span class="p">)</span>

        <span class="c1"># Closes the aom and the specified shutters</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">exposure</span>

        <span class="k">return</span> <span class="n">t</span></div>


    <span class="k">def</span> <span class="nf">_do_molasses_in_situ_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">reset_mot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="c1"># MOT loading time 500 ms</span>
        <span class="n">mot_load_dur</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_mot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mot_load_dur</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_molasses</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_time</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_molasses_dipole_trap_imaging</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Turn off MOT for taking background images</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mf">1e-1</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_TA_VCO_RAMP_TIME</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_molasses_dipole_trap_imaging</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mf">1e-2</span>

        <span class="k">if</span> <span class="n">reset_mot</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset_mot</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">_do_molasses_tof_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">reset_mot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="n">mot_load_dur</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_mot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">mot_load_dur</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_molasses</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_time</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_tof_imaging_delay</span> <span class="o">&gt;</span> <span class="n">CONST_MIN_SHUTTER_OFF_TIME</span><span class="p">,</span> <span class="s2">&quot;time of flight too short for shutter&quot;</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_tof_imaging_delay</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_molasses_dipole_trap_imaging</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Turn off MOT for taking background images</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mf">1e-1</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_molasses_dipole_trap_imaging</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="mf">1e-2</span>
        <span class="k">if</span> <span class="n">reset_mot</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset_mot</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span>

    <span class="c1">#TODO: refactor this more like the do_molasses_imaging thing above</span>
<div class="viewcode-block" id="MOTSequence.do_kinetix_imaging">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.MOTSequence.do_kinetix_imaging">[docs]</a>
    <span class="k">def</span> <span class="nf">do_kinetix_imaging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">shot_number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">open_ta_shutter</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">open_repump_shutter</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># TODO: Change globals away from &quot;do_mot_xy_beams_during_imaging&quot; to label as in open_mot_shutters(t, label=None)</span>
        <span class="k">if</span> <span class="n">shot_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_mot_beams_during_imaging</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">open_mot_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_beam_imaging_label</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_img_beams_during_imaging</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">open_img_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">img_beam_imaging_label</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">shot_number</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># pulse for the second shots and wait for the first shot to finish the</span>
            <span class="c1"># first reading</span>
            <span class="n">kinetix_readout_time</span> <span class="o">=</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">kinetix_roi_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">4.7065e-6</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;kinetix readout time:&#39;</span><span class="p">,</span> <span class="n">kinetix_readout_time</span><span class="p">)</span>
            <span class="c1"># need extra 7 ms for shutter to close on the second shot</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">kinetix_readout_time</span> <span class="o">+</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">kinetix_extra_readout_time</span>

            <span class="c1"># TODO: was previously called &quot;do_shutter_close_on_second_shot&quot; but this is a confusing name so</span>
            <span class="c1"># we need to change it in the globals files to what is written here:</span>
            <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">shutter_close_after_first_shot</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_mot_beams_during_imaging</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">open_mot_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_beam_imaging_label</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_img_beams_during_imaging</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">open_img_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">img_beam_imaging_label</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">mot_aom_on</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># TODO: what does this assert mean?</span>
        <span class="k">assert</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">img_exposure_time</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Imaging exposure time = 0, &quot;</span>
                                                    <span class="s2">&quot;did you forget to adjust &quot;</span>
                                                    <span class="s2">&quot;for the case?&quot;</span><span class="p">)</span>

        <span class="c1">#Replace with camera object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Camera_obj</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="s2">&quot;kinetix&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_kinetix_camera</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">img_exposure_time</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Camera_obj</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">exposure</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">exposure</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">mot_aom_off</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">shot_number</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">shutter_close_after_first_shot</span><span class="p">)</span> <span class="ow">or</span> <span class="n">shot_number</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_mot_beams_during_imaging</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">close_mot_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">mot_beam_imaging_label</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_img_beams_during_imaging</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">close_img_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">img_beam_imaging_label</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span></div>
</div>



<div class="viewcode-block" id="OpticalPumpingSequence">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.OpticalPumpingSequence">[docs]</a>
<span class="k">class</span> <span class="nc">OpticalPumpingSequence</span><span class="p">(</span><span class="n">MOTSequence</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OpticalPumpingSequence</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

<div class="viewcode-block" id="OpticalPumpingSequence.pump_to_F4">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.OpticalPumpingSequence.pump_to_F4">[docs]</a>
    <span class="k">def</span> <span class="nf">pump_to_F4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">mot_coils_on</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">mot_coils_off</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;mot&quot;</span><span class="p">:</span>
            <span class="c1"># Use the MOT beams for optical pumping</span>
            <span class="c1"># define quantization axis</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">ramp_bias_field</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">mw_biasx_field</span><span class="p">,</span>
                                                 <span class="n">shot_globals</span><span class="o">.</span><span class="n">mw_biasy_field</span><span class="p">,</span>
                                                 <span class="n">shot_globals</span><span class="o">.</span><span class="n">mw_biasz_field</span><span class="p">))</span>
            <span class="c1"># Do a repump pulse</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_MOT_op_time</span><span class="p">,</span>
                                    <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_REPUMP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;sigma&quot;</span><span class="p">:</span>
            <span class="c1"># Use the sigma+ beam for optical pumping</span>
            <span class="c1"># TODO: do we want shutters always closed for this ramping?</span>
            <span class="n">op_biasx_field</span><span class="p">,</span> <span class="n">op_biasy_field</span><span class="p">,</span> <span class="n">op_biasz_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">get_op_bias_fields</span><span class="p">()</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">ramp_bias_field</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">op_biasx_field</span><span class="p">,</span>
                                                 <span class="n">op_biasy_field</span><span class="p">,</span>
                                                 <span class="n">op_biasz_field</span><span class="p">))</span>
            <span class="c1"># ramp detuning to 4 -&gt; 4, 3 -&gt; 4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_ta_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CONST_TA_PUMPING_DETUNING</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_repump_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_repump_pumping_detuning</span><span class="p">)</span>
            <span class="c1"># Do a sigma+ pulse</span>
            <span class="c1"># TODO: is shot_globals.op_ramp_delay just extra fudge time? can it be eliminated?</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">CONST_TA_VCO_RAMP_TIME</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_ramp_delay</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span><span class="p">,</span>
                                       <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_repump_time</span><span class="p">,</span>
                                       <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">OPTICAL_PUMPING_FULL</span><span class="p">,</span>
                                       <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_ta_power</span><span class="p">,</span>
                                       <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_repump_power</span><span class="p">,)</span>
            <span class="c1"># Need to turn off the TA before repump, Sam claims this timing should work</span>
            <span class="k">assert</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_ta_time</span> <span class="o">&lt;</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_repump_time</span><span class="p">,</span> <span class="s2">&quot;TA time should be shorter than repump for pumping to F=4&quot;</span>
            <span class="c1"># TODO: test this timing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ta_aom_off</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_ta_time</span> <span class="o">-</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_repump_time</span><span class="p">)</span>
            <span class="c1"># Close the shutters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">update_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_SHUTTER_TURN_OFF_TIME</span>

            <span class="k">return</span> <span class="n">t</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This optical pumping method is not implemented&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalPumpingSequence.depump_to_F3">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.OpticalPumpingSequence.depump_to_F3">[docs]</a>
    <span class="k">def</span> <span class="nf">depump_to_F3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="c1"># This method should be quite similar to pump_to_F4, but trying to call pump_to_F4 with</span>
        <span class="c1"># different parameters would produce a very long argument list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">mot_coils_on</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">mot_coils_off</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;mot&quot;</span><span class="p">:</span>
            <span class="c1"># Use the MOT beams for optical depumping</span>
            <span class="c1"># define quantization axis</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">ramp_bias_field</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">mw_biasx_field</span><span class="p">,</span>
                                                 <span class="n">shot_globals</span><span class="o">.</span><span class="n">mw_biasy_field</span><span class="p">,</span>
                                                 <span class="n">shot_globals</span><span class="o">.</span><span class="n">mw_biasz_field</span><span class="p">))</span>
            <span class="c1"># ramp detuning to 4 -&gt; 4 for TA</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_ta_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CONST_TA_PUMPING_DETUNING</span><span class="p">)</span>
            <span class="c1"># Do a repump pulse</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_MOT_odp_time</span><span class="p">,</span>
                                    <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">MOT_REPUMP</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;sigma&quot;</span><span class="p">:</span>
            <span class="c1"># Use the sigma+ beam for optical pumping</span>
            <span class="c1"># TODO: do we want shutters always closed for this ramping?</span>
            <span class="n">op_biasx_field</span><span class="p">,</span> <span class="n">op_biasy_field</span><span class="p">,</span> <span class="n">op_biasz_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">get_op_bias_fields</span><span class="p">()</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BField_obj</span><span class="o">.</span><span class="n">ramp_bias_field</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">op_biasx_field</span><span class="p">,</span>
                                                 <span class="n">op_biasy_field</span><span class="p">,</span>
                                                 <span class="n">op_biasz_field</span><span class="p">))</span>
            <span class="c1"># ramp detuning to 4 -&gt; 4, 3 -&gt; 3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_ta_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CONST_TA_PUMPING_DETUNING</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_repump_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CONST_REPUMP_DEPUMPING_DETUNING</span><span class="p">)</span>
            <span class="c1"># Do a sigma+ pulse</span>
            <span class="c1"># TODO: is shot_globals.op_ramp_delay just extra fudge time? can it be eliminated?</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="n">CONST_TA_VCO_RAMP_TIME</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_ramp_delay</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">CONST_SHUTTER_TURN_ON_TIME</span><span class="p">,</span>
                                       <span class="n">shot_globals</span><span class="o">.</span><span class="n">odp_repump_time</span><span class="p">,</span>
                                       <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">OPTICAL_PUMPING_FULL</span><span class="p">,</span>
                                       <span class="n">shot_globals</span><span class="o">.</span><span class="n">odp_ta_power</span><span class="p">,</span>
                                       <span class="n">shot_globals</span><span class="o">.</span><span class="n">odp_repump_power</span><span class="p">,)</span>
            <span class="c1"># Need to turn off the TA before repump, Sam claims this timing should work</span>
            <span class="k">assert</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">odp_ta_time</span> <span class="o">&gt;</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">odp_repump_time</span><span class="p">,</span> <span class="s2">&quot;TA time should be longer than repump for depumping to F = 3&quot;</span>
            <span class="c1"># TODO: test this timing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ta_aom_off</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">odp_ta_time</span> <span class="o">-</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">odp_repump_time</span><span class="p">)</span>
            <span class="c1"># Close the shutters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">update_shutters</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_SHUTTER_TURN_OFF_TIME</span>

            <span class="k">return</span> <span class="n">t</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This optical depumping method is not implemented&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="OpticalPumpingSequence.kill_F4">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.OpticalPumpingSequence.kill_F4">[docs]</a>
    <span class="k">def</span> <span class="nf">kill_F4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Push away atoms in F = 4 &#39;&#39;&#39;</span>
        <span class="c1"># tune to resonance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">ramp_ta_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">CONST_TA_VCO_RAMP_TIME</span>
        <span class="c1"># do a ta pulse via optical pumping path</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">do_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_killing_killing_pulse_time</span><span class="p">,</span>
                                    <span class="n">ShutterConfig</span><span class="o">.</span><span class="n">OPTICAL_PUMPING_FULL</span><span class="p">,</span>
                                    <span class="n">shot_globals</span><span class="o">.</span><span class="n">op_killing_ta_power</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalPumpingSequence.kill_F3">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.OpticalPumpingSequence.kill_F3">[docs]</a>
    <span class="k">def</span> <span class="nf">kill_F3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>




<div class="viewcode-block" id="TweezerSequence">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerSequence">[docs]</a>
<span class="k">class</span> <span class="nc">TweezerSequence</span><span class="p">(</span><span class="n">MOTSequence</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TweezerSequence</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TweezerLaser_obj</span> <span class="o">=</span> <span class="n">TweezerLaser</span><span class="p">()</span>

<div class="viewcode-block" id="TweezerSequence.load_tweezers">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerSequence.load_tweezers">[docs]</a>
    <span class="k">def</span> <span class="nf">load_tweezers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_mot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_molasses</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_time</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mf">7e-3</span>
        <span class="c1"># ramp to full power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TweezerLaser_obj</span><span class="o">.</span><span class="n">ramp_power</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="o">=</span><span class="mf">10e-3</span><span class="p">,</span> <span class="n">final_power</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mf">10e-3</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D2Lasers_obj</span><span class="o">.</span><span class="n">parity_projection_pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_parity_projection_pulse_dur</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_molasses</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="o">=</span><span class="n">shot_globals</span><span class="o">.</span><span class="n">bm_time</span><span class="p">,</span> <span class="n">close_all_shutters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span></div>


<div class="viewcode-block" id="TweezerSequence.rearrange_to_dense">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerSequence.rearrange_to_dense">[docs]</a>
    <span class="k">def</span> <span class="nf">rearrange_to_dense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="TweezerSequence.image_tweezers">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerSequence.image_tweezers">[docs]</a>
    <span class="k">def</span> <span class="nf">image_tweezers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">shot_number</span><span class="p">):</span>
        <span class="c1"># TODO: do_kinetix_imaging needs to include pre_imaging ramps</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_kinetix_imaging</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shot_number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="TweezerSequence.tweezer_modulation">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.TweezerSequence.tweezer_modulation">[docs]</a>
    <span class="k">def</span> <span class="nf">tweezer_modulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sine&#39;</span><span class="p">):</span>
        <span class="k">pass</span></div>


    <span class="k">def</span> <span class="nf">_tweezer_release_recapture_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_tweezer_modulation_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">pass</span></div>


<span class="c1"># I think we should leave both 456 and 1064 stuff here because really the only debugging</span>
<span class="c1"># we would need to do is checking their overlap or looking for a Rydberg loss signal in the dipole trap</span>
<div class="viewcode-block" id="RydSequence">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydSequence">[docs]</a>
<span class="k">class</span> <span class="nc">RydSequence</span><span class="p">(</span><span class="n">TweezerSequence</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RydSequence</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RydLasers_obj</span> <span class="o">=</span> <span class="n">RydLasers</span><span class="p">()</span>

<div class="viewcode-block" id="RydSequence.pulse_blue">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydSequence.pulse_blue">[docs]</a>
    <span class="k">def</span> <span class="nf">pulse_blue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="RydSequence.pulse_1064">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.RydSequence.pulse_1064">[docs]</a>
    <span class="k">def</span> <span class="nf">pulse_1064</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dur</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>




<span class="c1">#Full Sequences, we&#39;ll see if we really want all these in a class or just separate sequence files?</span>
<div class="viewcode-block" id="ScienceSequence">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.ScienceSequence">[docs]</a>
<span class="k">class</span> <span class="nc">ScienceSequence</span><span class="p">(</span><span class="n">RydSequence</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ScienceSequence</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></div>


<span class="c1">#Should we separate this from ScienceSequence?</span>
<div class="viewcode-block" id="DiagnosticSequence">
<a class="viewcode-back" href="../../api.html#standard_sequence.classy_sequence.DiagnosticSequence">[docs]</a>
<span class="k">class</span> <span class="nc">DiagnosticSequence</span><span class="p">(</span><span class="n">RydSequence</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DiagnosticSequence</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></div>




<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">labscript</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Insert &quot;stay on&quot; statements for alignment here...</span>

    <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_mot_in_situ_check</span><span class="p">:</span>
        <span class="n">MOTSeq_obj</span> <span class="o">=</span> <span class="n">MOTSequence</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">MOTSeq_obj</span><span class="o">.</span><span class="n">_do_mot_in_situ_sequence</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">reset_mot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_mot_tof_check</span><span class="p">:</span>
        <span class="n">MOTSeq_obj</span> <span class="o">=</span> <span class="n">MOTSequence</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">MOTSeq_obj</span><span class="o">.</span><span class="n">_do_mot_tof_sequence</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">reset_mot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_molasses_in_situ_check</span><span class="p">:</span>
        <span class="n">MOTSeq_obj</span> <span class="o">=</span> <span class="n">MOTSequence</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">MOTSeq_obj</span><span class="o">.</span><span class="n">_do_molasses_in_situ_sequence</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">reset_mot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">shot_globals</span><span class="o">.</span><span class="n">do_molasses_tof_check</span><span class="p">:</span>
        <span class="n">MOTSeq_obj</span> <span class="o">=</span> <span class="n">MOTSequence</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">MOTSeq_obj</span><span class="o">.</span><span class="n">_do_molasses_tof_sequence</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">reset_mot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># if shot_globals.do_field_calib_in_molasses_check:</span>
    <span class="c1">#     t = do_field_calib_in_molasses_check(t)</span>

    <span class="c1"># if shot_globals.do_dipole_trap_tof_check:</span>
    <span class="c1">#     t = do_dipole_trap_tof_check(t)</span>

    <span class="c1"># if shot_globals.do_img_beam_alignment_check:</span>
    <span class="c1">#     t = do_img_beam_alignment_check(t)</span>

    <span class="c1"># if shot_globals.do_tweezer_position_check:</span>
    <span class="c1">#     t = do_tweezer_position_check(t)</span>

    <span class="c1"># if shot_globals.do_tweezer_check:</span>
    <span class="c1">#     t = do_tweezer_check(t)</span>

    <span class="c1"># if shot_globals.do_tweezer_check_fifo:</span>
    <span class="c1">#     t = do_tweezer_check_fifo(t)</span>

    <span class="c1"># if shot_globals.do_optical_pump_in_tweezer_check:</span>
    <span class="c1">#     t = do_optical_pump_in_tweezer_check(t)</span>

    <span class="c1"># if shot_globals.do_optical_pump_in_microtrap_check:</span>
    <span class="c1">#     t = do_optical_pump_in_microtrap_check(t)</span>

    <span class="n">labscript</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mf">1e-2</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Michelle Wu, Lin Xin, Nolan Peard, Sam Cohen, Tony Zhang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>